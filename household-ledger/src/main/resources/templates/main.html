<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/layout}">

<head>
    <title>ë©”ì¸ - í•œí‘¼í•œí‘¼</title>
</head>

<body>
    <div layout:fragment="content" class="fade-in">
        <section class="hero-section">
            <div class="glass-card hero-card">
                <h1>ì•ˆë…•í•˜ì„¸ìš”, <span class="highlight-text"
                        th:text="${session.userNm != null ? session.userNm : 'ë°©ë¬¸ì'}">User</span>ë‹˜!</h1>
                <p>ë‹¹ì‹ ì˜ ì†Œì¤‘í•œ ìì‚°, <strong>í•œí‘¼í•œí‘¼</strong> ê¼¼ê¼¼í•˜ê²Œ ê´€ë¦¬í•´ ë“œë¦´ê²Œìš”.</p>
                <div class="action-buttons">
                    <button @click="showModal('register')" class="btn-primary">ğŸ“ ë‚´ì—­ ì¶”ê°€í•˜ê¸°</button>
                    <button @click="goToStats" class="btn-secondary">ğŸ“Š í†µê³„ í™•ì¸í•˜ê¸°</button>
                </div>
            </div>
        </section>

        <!-- Dashboard Widgets -->
        <section class="dashboard-grid">
            <!-- Widget 1: Recent Activity -->
            <div class="glass-card stat-card">
                <h3>ğŸ’° ì´ë²ˆ ë‹¬ ì§€ì¶œ</h3>
                <div v-if="loading" class="skeleton-wrapper">
                    <div class="skeleton-title" style="width: 40%"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div v-else class="stat-content">
                    <h2 class="amount">{{ formatCurrency(monthlyTotal) }}</h2>
                    <p class="diff-text">ì§€ë‚œë‹¬ ëŒ€ë¹„ <span class="badge-up">â–² 12%</span></p>
                </div>
            </div>

            <!-- Widget 2: Today's Spending -->
            <div class="glass-card stat-card">
                <h3>ğŸ“… ì˜¤ëŠ˜ì˜ ì†Œë¹„</h3>
                <div v-if="loading" class="skeleton-wrapper">
                    <div class="skeleton-title" style="width: 40%"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div v-else class="stat-content">
                    <h2 class="amount">{{ formatCurrency(todayTotal) }}</h2>
                    <p class="sub-text">ì»¤í”¼ í•œ ì”ì˜ ì—¬ìœ  â˜•</p>
                </div>
            </div>

            <!-- Widget 3: Budget Status -->
            <div class="glass-card stat-card">
                <h3>ğŸ’³ ì˜ˆì‚° í˜„í™©</h3>
                <div v-if="loading" class="skeleton-wrapper">
                    <div class="skeleton-title" style="width: 40%"></div>
                    <div class="skeleton-text"></div>
                </div>
                <div v-else class="stat-content">
                    <div class="progress-bar-container">
                        <div class="progress-bar" :style="{ width: budgetPercent + '%' }"></div>
                    </div>
                    <p class="limit-text">{{ budgetPercent }}% ì‚¬ìš©í•¨</p>
                </div>
            </div>
        </section>

        <!-- Modals -->
        <transition name="fade">
            <div v-if="activeModal" class="modal-overlay" @click.self="closeModal">

                <!-- 1. LOGIN MODAL -->
                <div v-if="activeModal === 'login'" class="modal-content">
                    <span class="team-badge">Team Member: ìœ¤ì„±ì›</span>
                    <div class="modal-header">
                        <h2>ë¡œê·¸ì¸</h2>
                        <button class="close-btn" @click="closeModal">&times;</button>
                    </div>
                    <form @submit.prevent="submitLogin">
                        <div class="form-group">
                            <label>ì•„ì´ë””</label>
                            <input type="text" class="form-control" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-secondary" @click="showModal('join')">íšŒì›ê°€ì…</button>
                            <button type="submit" class="btn-primary">ë¡œê·¸ì¸</button>
                        </div>
                    </form>
                </div>

                <!-- 2. JOIN MODAL -->
                <div v-if="activeModal === 'join'" class="modal-content">
                    <span class="team-badge">Team Member: ìœ¤ì„±ì›</span>
                    <div class="modal-header">
                        <h2>íšŒì›ê°€ì…</h2>
                        <button class="close-btn" @click="closeModal">&times;</button>
                    </div>
                    <form>
                        <div class="form-group">
                            <label>ì•„ì´ë””</label>
                            <input type="text" class="form-control" placeholder="ì‚¬ìš©í•  ì•„ì´ë””">
                        </div>
                        <div class="form-group">
                            <label>ì´ë¦„</label>
                            <input type="text" class="form-control" placeholder="ë³¸ëª…">
                        </div>
                        <div class="form-group">
                            <label>ë¹„ë°€ë²ˆí˜¸</label>
                            <input type="password" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸">
                        </div>
                        <div class="form-group">
                            <label>ì´ë©”ì¼</label>
                            <input type="email" class="form-control" placeholder="example@email.com">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-secondary" @click="showModal('login')">ëŒì•„ê°€ê¸°</button>
                            <button type="submit" class="btn-primary">ê°€ì…í•˜ê¸°</button>
                        </div>
                    </form>
                </div>

                <!-- 3. LEDGER WRITE MODAL -->
                <div v-if="activeModal === 'register'" class="modal-content">
                    <span class="team-badge">Team Member: ì •ë³‘ì§„</span>
                    <div class="modal-header">
                        <h2>ê°€ê³„ë¶€ ë“±ë¡</h2>
                        <button class="close-btn" @click="closeModal">&times;</button>
                    </div>
                    <form>
                        <div class="form-group">
                            <label>ë‚ ì§œ</label>
                            <input type="date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>ê¸ˆì•¡</label>
                            <input type="number" class="form-control" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>ë¶„ë¥˜</label>
                            <select class="form-control">
                                <option>ì¹´í…Œê³ ë¦¬ ì„ íƒ (ê³µí†µì½”ë“œ)</option>
                                <option>ì‹ë¹„</option>
                                <option>êµí†µë¹„</option>
                                <option>ì›”ê¸‰</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ë©”ëª¨</label>
                            <textarea class="form-control" rows="3" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-secondary" @click="closeModal">ì·¨ì†Œ</button>
                            <button type="submit" class="btn-primary">ì €ì¥</button>
                        </div>
                    </form>
                </div>

            </div>
        </transition>
    </div>

    <th:block layout:fragment="script">
        <script>
            const { createApp, ref, onMounted } = Vue;

            createApp({
                setup() {
                    const loading = ref(true);
                    const monthlyTotal = ref(0);
                    const todayTotal = ref(0);
                    const budgetPercent = ref(0);
                    const activeModal = ref(null); // 'login', 'join', 'register', or null

                    // Mock Data Loading Simulation
                    onMounted(() => {
                        setTimeout(() => {
                            monthlyTotal.value = 1250000;
                            todayTotal.value = 15300;
                            budgetPercent.value = 65;
                            loading.value = false;
                        }, 1000); // 1.0s delay
                    });

                    const showModal = (type) => {
                        activeModal.value = type;
                    };

                    const closeModal = () => {
                        activeModal.value = null;
                    };

                    const submitLogin = () => {
                        alert("ë¡œê·¸ì¸ ê¸°ëŠ¥ì€ [MemberController]ì—ì„œ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.");
                        closeModal();
                    };

                    const goToStats = () => {
                        // alert('í†µê³„ í˜ì´ì§€ë„ ê³§ ì¤€ë¹„ë©ë‹ˆë‹¤! (Team Member: ìµœí˜„ì§€)');
                        // Temporary logic to show a toast or message
                        console.log("Go to stats");
                    };

                    const formatCurrency = (value) => {
                        return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(value);
                    };

                    return {
                        loading,
                        monthlyTotal,
                        todayTotal,
                        budgetPercent,
                        activeModal,
                        showModal,
                        closeModal,
                        submitLogin,
                        goToStats,
                        formatCurrency
                    };
                }
            }).mount('#app');
        </script>


    </th:block>
</body>

</html>